"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("primereact/hooks"),n=require("primereact/inputtext"),t=require("primereact/utils");function u(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})}})),r.default=e,Object.freeze(r)}var c=u(e);function a(){return a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},a.apply(this,arguments)}function l(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){l(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var f=c.memo(c.forwardRef((function(e,u){var l=c.useRef(u),o=c.useRef(null),s=c.useRef(0),v=c.useRef([]),p=c.useRef([]),g=c.useRef(0),d=c.useRef(null),m=c.useRef(!1),b=c.useRef(null),h=c.useRef(null),y=c.useRef(null),O=c.useRef(null),k=c.useRef(null),j=c.useRef(!1),C=function(e,r){var n,t,u,c=l.current;if(c&&c.offsetParent&&c===document.activeElement)return"number"!=typeof e?(c.setSelectionRange?(t=c.selectionStart,u=c.selectionEnd):document.selection&&document.selection.createRange&&(u=(t=0-(n=document.selection.createRange()).duplicate().moveStart("character",-1e5))+n.text.length),{begin:t,end:u}):(t=e,u="number"==typeof r?r:t,void(c.setSelectionRange?c.setSelectionRange(t,u):c.createTextRange&&((n=c.createTextRange()).collapse(!0),n.moveEnd("character",u),n.moveStart("character",t),n.select())))},R=function(){for(var e=o.current;e<=s.current;e++)if(v.current[e]&&p.current[e]===E(e))return!1;return!0},E=c.useCallback((function(r){return e.slotChar.charAt(r<e.slotChar.length?r:0)}),[e.slotChar]),P=function(){return e.unmask?U():l.current&&l.current.value},x=function(e){for(;++e<g.current&&!v.current[e];);return e},D=function(e){for(;--e>=0&&!v.current[e];);return e},w=function(e,r){var n,t;if(!(e<0)){for(n=e,t=x(r);n<g.current;n++)if(v.current[n]){if(!(t<g.current&&v.current[n].test(p.current[t])))break;p.current[n]=p.current[t],p.current[t]=E(t),t=x(t)}M(),C(Math.max(o.current,e))}},I=function(e){var r,n,t,u;for(r=e,n=E(e);r<g.current;r++)if(v.current[r]){if(t=x(r),u=p.current[r],p.current[r]=n,!(t<g.current&&v.current[t].test(u)))break;n=u}},S=function(r){var n=l.current.value,t=C();if(d.current.length&&d.current.length>n.length){for(q(!0);t.begin>0&&!v.current[t.begin-1];)t.begin--;if(0===t.begin)for(;t.begin<o.current&&!v.current[t.begin];)t.begin++;C(t.begin,t.begin)}else{for(q(!0);t.begin<g.current&&!v.current[t.begin];)t.begin++;C(t.begin,t.begin)}e.onComplete&&R()&&e.onComplete({originalEvent:r,value:P()}),_(r)},T=function(r){if(m.current=!1,q(),_(r),z(),e.onBlur&&e.onBlur(r),l.current.value!==b.current){var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!1),l.current.dispatchEvent(n)}},A=function(e,r){var n;for(n=e;n<r&&n<g.current;n++)v.current[n]&&(p.current[n]=E(n))},M=function(){l.current.value=p.current.join("")},q=function(r){h.current=!0;var n,t,u,c=l.current.value,a=-1;for(n=0,u=0;n<g.current;n++)if(v.current[n]){for(p.current[n]=E(n);u++<c.length;)if(t=c.charAt(u-1),v.current[n].test(t)){p.current[n]=t,a=n;break}if(u>c.length){A(n+1,g.current);break}}else p.current[n]===c.charAt(u)&&u++,n<y.current&&(a=n);return r?M():a+1<y.current?e.autoClear||p.current.join("")===O.current?(l.current.value&&(l.current.value=""),A(0,g.current)):M():(M(),l.current.value=l.current.value.substring(0,a+1)),y.current?n:o.current},H=function(r){if(!e.readOnly){var n=q(!0);C(n),_(r),e.onComplete&&R()&&e.onComplete({originalEvent:r,value:P()})}},U=c.useCallback((function(){for(var e=[],r=0;r<p.current.length;r++){var n=p.current[r];v.current[r]&&n!==E(r)&&e.push(n)}return e.join("")}),[E]),_=function(r){if(e.onChange){var n=e.unmask?U():r&&r.target.value;e.onChange({originalEvent:r,value:O.current!==n?n:"",stopPropagation:function(){},preventDefault:function(){},target:{name:e.name,id:e.id,value:O.current!==n?n:""}})}},z=function(){l.current&&l.current.value&&l.current.value.length>0?t.DomHandler.addClass(l.current,"p-filled"):t.DomHandler.removeClass(l.current,"p-filled")},K=function(r){var n;return l.current&&(null==e.value?l.current.value="":(l.current.value=e.value,n=q(r),setTimeout((function(){if(l.current)return M(),q(r)}),10)),b.current=l.current.value),z(),n},N=c.useCallback((function(){return e.unmask?e.value!==U():O.current!==l.current.value&&l.current.value!==e.value}),[e.unmask,e.value,U]),B=function(){if(e.mask){v.current=[],y.current=e.mask.length,g.current=e.mask.length,o.current=null;var r={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},n=t.DomHandler.getUserAgent();j.current=/chrome/i.test(n)&&/android/i.test(n);for(var u=e.mask.split(""),c=0;c<u.length;c++){var a=u[c];"?"===a?(g.current--,y.current=c):r[a]?(v.current.push(new RegExp(r[a])),null===o.current&&(o.current=v.current.length-1),c<y.current&&(s.current=v.current.length-1)):v.current.push(null)}p.current=[];for(var l=0;l<u.length;l++){var i=u[l];"?"!==i&&p.current.push(r[i]?E(l):i)}O.current=p.current.join("")}};c.useImperativeHandle(u,(function(){return i({getElement:function(){return l.current}},e)})),c.useEffect((function(){t.ObjectUtils.combinedRefs(l,u)}),[l,u]),r.useMountEffect((function(){B(),K()})),r.useUpdateEffect((function(){B(),C(K(!0)),e.unmask&&_()}),[e.mask]),r.useUpdateEffect((function(){N()&&K()}),[N]);var F=t.ObjectUtils.findDiffKeys(e,f.defaultProps),L=t.classNames("p-inputmask",e.className);return c.createElement(n.InputText,a({ref:l,id:e.id,type:e.type,name:e.name,style:e.style,className:L},F,{placeholder:e.placeholder,size:e.size,maxLength:e.maxLength,tabIndex:e.tabIndex,disabled:e.disabled,readOnly:e.readOnly,onFocus:function(r){var n;e.readOnly||(m.current=!0,clearTimeout(k.current),b.current=l.current.value,n=q(),k.current=setTimeout((function(){l.current===document.activeElement&&(M(),n===e.mask.replace("?","").length?C(0,n):C(n),z())}),10),e.onFocus&&e.onFocus(r))},onBlur:T,onKeyDown:function(r){if(!e.readOnly){var n,u,c,a=r.which||r.keyCode,o=/iphone/i.test(t.DomHandler.getUserAgent());d.current=l.current.value,8===a||46===a||o&&127===a?((c=(n=C()).end)-(u=n.begin)==0&&(u=46!==a?D(u):c=x(u-1),c=46===a?x(c):c),A(u,c),w(u,c-1),_(r),r.preventDefault()):13===a?(T(r),_(r)):27===a&&(l.current.value=b.current,C(0,q()),_(r),r.preventDefault())}},onKeyPress:function(r){if(!e.readOnly){var n,u,c,a,l=r.which||r.keyCode,o=C();if(!(r.ctrlKey||r.altKey||r.metaKey||l<32)){if(l&&13!==l){if(o.end-o.begin!=0&&(A(o.begin,o.end),w(o.begin,o.end-1)),(n=x(o.begin-1))<g.current&&(u=String.fromCharCode(l),v.current[n].test(u))){if(I(n),p.current[n]=u,M(),c=x(n),/android/i.test(t.DomHandler.getUserAgent())){setTimeout((function(){C(c)}),0)}else C(c);o.begin<=s.current&&(a=R())}r.preventDefault()}_(r),e.onComplete&&a&&e.onComplete({originalEvent:r,value:P()})}}},onInput:function(e){j.current?S(e):H(e)},onPaste:H,required:e.required,tooltip:e.tooltip,tooltipOptions:e.tooltipOptions}))})));f.displayName="InputMask",f.defaultProps={__TYPE:"InputMask",id:null,value:null,type:"text",mask:null,slotChar:"_",autoClear:!0,unmask:!1,style:null,className:null,placeholder:null,size:null,maxLength:null,tabIndex:null,disabled:!1,readOnly:!1,name:null,required:!1,tooltip:null,tooltipOptions:null,onComplete:null,onChange:null,onFocus:null,onBlur:null},exports.InputMask=f;
