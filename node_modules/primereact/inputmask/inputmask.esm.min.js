import*as e from"react";import{useMountEffect as r,useUpdateEffect as n}from"primereact/hooks";import{InputText as t}from"primereact/inputtext";import{ObjectUtils as u,classNames as c,DomHandler as a}from"primereact/utils";function l(){return l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},l.apply(this,arguments)}function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function i(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function f(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?i(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var s=e.memo(e.forwardRef((function(o,i){var v=e.useRef(i),p=e.useRef(null),g=e.useRef(0),m=e.useRef([]),d=e.useRef([]),b=e.useRef(0),h=e.useRef(null),y=e.useRef(!1),O=e.useRef(null),k=e.useRef(null),C=e.useRef(null),R=e.useRef(null),E=e.useRef(null),j=e.useRef(!1),P=function(e,r){var n,t,u,c=v.current;if(c&&c.offsetParent&&c===document.activeElement)return"number"!=typeof e?(c.setSelectionRange?(t=c.selectionStart,u=c.selectionEnd):document.selection&&document.selection.createRange&&(u=(t=0-(n=document.selection.createRange()).duplicate().moveStart("character",-1e5))+n.text.length),{begin:t,end:u}):(t=e,u="number"==typeof r?r:t,void(c.setSelectionRange?c.setSelectionRange(t,u):c.createTextRange&&((n=c.createTextRange()).collapse(!0),n.moveEnd("character",u),n.moveStart("character",t),n.select())))},x=function(){for(var e=p.current;e<=g.current;e++)if(m.current[e]&&d.current[e]===w(e))return!1;return!0},w=e.useCallback((function(e){return o.slotChar.charAt(e<o.slotChar.length?e:0)}),[o.slotChar]),D=function(){return o.unmask?N():v.current&&v.current.value},S=function(e){for(;++e<b.current&&!m.current[e];);return e},A=function(e){for(;--e>=0&&!m.current[e];);return e},T=function(e,r){var n,t;if(!(e<0)){for(n=e,t=S(r);n<b.current;n++)if(m.current[n]){if(!(t<b.current&&m.current[n].test(d.current[t])))break;d.current[n]=d.current[t],d.current[t]=w(t),t=S(t)}F(),P(Math.max(p.current,e))}},I=function(e){var r,n,t,u;for(r=e,n=w(e);r<b.current;r++)if(m.current[r]){if(t=S(r),u=d.current[r],d.current[r]=n,!(t<b.current&&m.current[t].test(u)))break;n=u}},K=function(e){var r=v.current.value,n=P();if(h.current.length&&h.current.length>r.length){for(L(!0);n.begin>0&&!m.current[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<p.current&&!m.current[n.begin];)n.begin++;P(n.begin,n.begin)}else{for(L(!0);n.begin<b.current&&!m.current[n.begin];)n.begin++;P(n.begin,n.begin)}o.onComplete&&x()&&o.onComplete({originalEvent:e,value:D()}),q(e)},z=function(e){if(y.current=!1,L(),q(e),U(),o.onBlur&&o.onBlur(e),v.current.value!==O.current){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),v.current.dispatchEvent(r)}},B=function(e,r){var n;for(n=e;n<r&&n<b.current;n++)m.current[n]&&(d.current[n]=w(n))},F=function(){v.current.value=d.current.join("")},L=function(e){k.current=!0;var r,n,t,u=v.current.value,c=-1;for(r=0,t=0;r<b.current;r++)if(m.current[r]){for(d.current[r]=w(r);t++<u.length;)if(n=u.charAt(t-1),m.current[r].test(n)){d.current[r]=n,c=r;break}if(t>u.length){B(r+1,b.current);break}}else d.current[r]===u.charAt(t)&&t++,r<C.current&&(c=r);return e?F():c+1<C.current?o.autoClear||d.current.join("")===R.current?(v.current.value&&(v.current.value=""),B(0,b.current)):F():(F(),v.current.value=v.current.value.substring(0,c+1)),C.current?r:p.current},M=function(e){if(!o.readOnly){var r=L(!0);P(r),q(e),o.onComplete&&x()&&o.onComplete({originalEvent:e,value:D()})}},N=e.useCallback((function(){for(var e=[],r=0;r<d.current.length;r++){var n=d.current[r];m.current[r]&&n!==w(r)&&e.push(n)}return e.join("")}),[w]),q=function(e){if(o.onChange){var r=o.unmask?N():e&&e.target.value;o.onChange({originalEvent:e,value:R.current!==r?r:"",stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:R.current!==r?r:""}})}},U=function(){v.current&&v.current.value&&v.current.value.length>0?a.addClass(v.current,"p-filled"):a.removeClass(v.current,"p-filled")},_=function(e){var r;return v.current&&(null==o.value?v.current.value="":(v.current.value=o.value,r=L(e),setTimeout((function(){if(v.current)return F(),L(e)}),10)),O.current=v.current.value),U(),r},H=e.useCallback((function(){return o.unmask?o.value!==N():R.current!==v.current.value&&v.current.value!==o.value}),[o.unmask,o.value,N]),Z=function(){if(o.mask){m.current=[],C.current=o.mask.length,b.current=o.mask.length,p.current=null;var e={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},r=a.getUserAgent();j.current=/chrome/i.test(r)&&/android/i.test(r);for(var n=o.mask.split(""),t=0;t<n.length;t++){var u=n[t];"?"===u?(b.current--,C.current=t):e[u]?(m.current.push(new RegExp(e[u])),null===p.current&&(p.current=m.current.length-1),t<C.current&&(g.current=m.current.length-1)):m.current.push(null)}d.current=[];for(var c=0;c<n.length;c++){var l=n[c];"?"!==l&&d.current.push(e[l]?w(c):l)}R.current=d.current.join("")}};e.useImperativeHandle(i,(function(){return f({getElement:function(){return v.current}},o)})),e.useEffect((function(){u.combinedRefs(v,i)}),[v,i]),r((function(){Z(),_()})),n((function(){Z(),P(_(!0)),o.unmask&&q()}),[o.mask]),n((function(){H()&&_()}),[H]);var Y=u.findDiffKeys(o,s.defaultProps),G=c("p-inputmask",o.className);return e.createElement(t,l({ref:v,id:o.id,type:o.type,name:o.name,style:o.style,className:G},Y,{placeholder:o.placeholder,size:o.size,maxLength:o.maxLength,tabIndex:o.tabIndex,disabled:o.disabled,readOnly:o.readOnly,onFocus:function(e){var r;o.readOnly||(y.current=!0,clearTimeout(E.current),O.current=v.current.value,r=L(),E.current=setTimeout((function(){v.current===document.activeElement&&(F(),r===o.mask.replace("?","").length?P(0,r):P(r),U())}),10),o.onFocus&&o.onFocus(e))},onBlur:z,onKeyDown:function(e){if(!o.readOnly){var r,n,t,u=e.which||e.keyCode,c=/iphone/i.test(a.getUserAgent());h.current=v.current.value,8===u||46===u||c&&127===u?((t=(r=P()).end)-(n=r.begin)==0&&(n=46!==u?A(n):t=S(n-1),t=46===u?S(t):t),B(n,t),T(n,t-1),q(e),e.preventDefault()):13===u?(z(e),q(e)):27===u&&(v.current.value=O.current,P(0,L()),q(e),e.preventDefault())}},onKeyPress:function(e){if(!o.readOnly){var r,n,t,u,c=e.which||e.keyCode,l=P();if(!(e.ctrlKey||e.altKey||e.metaKey||c<32)){if(c&&13!==c){if(l.end-l.begin!=0&&(B(l.begin,l.end),T(l.begin,l.end-1)),(r=S(l.begin-1))<b.current&&(n=String.fromCharCode(c),m.current[r].test(n))){if(I(r),d.current[r]=n,F(),t=S(r),/android/i.test(a.getUserAgent())){setTimeout((function(){P(t)}),0)}else P(t);l.begin<=g.current&&(u=x())}e.preventDefault()}q(e),o.onComplete&&u&&o.onComplete({originalEvent:e,value:D()})}}},onInput:function(e){j.current?K(e):M(e)},onPaste:M,required:o.required,tooltip:o.tooltip,tooltipOptions:o.tooltipOptions}))})));s.displayName="InputMask",s.defaultProps={__TYPE:"InputMask",id:null,value:null,type:"text",mask:null,slotChar:"_",autoClear:!0,unmask:!1,style:null,className:null,placeholder:null,size:null,maxLength:null,tabIndex:null,disabled:!1,readOnly:!1,name:null,required:!1,tooltip:null,tooltipOptions:null,onComplete:null,onChange:null,onFocus:null,onBlur:null};export{s as InputMask};
