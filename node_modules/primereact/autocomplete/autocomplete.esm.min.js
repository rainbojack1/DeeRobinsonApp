import*as e from"react";import t from"primereact/api";import{Button as n}from"primereact/button";import{useOverlayListener as r,useMountEffect as l,useUpdateEffect as o,useUnmountEffect as i}from"primereact/hooks";import{InputText as a}from"primereact/inputtext";import{OverlayService as u}from"primereact/overlayservice";import{Tooltip as c}from"primereact/tooltip";import{classNames as p,ObjectUtils as s,UniqueComponentId as m,DomHandler as f,ZIndexUtils as d,IconUtils as g}from"primereact/utils";import{CSSTransition as v}from"primereact/csstransition";import{Portal as y}from"primereact/portal";import{Ripple as b}from"primereact/ripple";import{VirtualScroller as h}from"primereact/virtualscroller";function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){if(Array.isArray(e))return w(e)}function S(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function x(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e){if(Array.isArray(e))return e}function D(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){a=!0,l=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw l}}return o}}function N(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(e,t){return I(e)||D(e,t)||x(e,t)||N()}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=e.memo(e.forwardRef((function(t,n){var r,l,o,i=function(e){return s.resolveFieldData(e,t.optionGroupLabel)},a=function(n,r,l){return t.getOptionGroupChildren(n).map((function(n,o){var i=r+"_"+o,a=t.selectedItem===n,u=t.itemTemplate?s.getJSXElement(t.itemTemplate,n,o):t.field?s.resolveFieldData(n,t.field):n;return e.createElement("li",{key:i,role:"option","aria-selected":a,className:"p-autocomplete-item",style:l,onClick:function(e){return t.onItemClick(e,n)},"data-group":r,"data-index":o},u,e.createElement(b,null))}))},u=function(n,r){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={height:l.props?l.props.itemSize:void 0};if(t.optionGroupLabel){var u=t.optionGroupTemplate?s.getJSXElement(t.optionGroupTemplate,n,r):t.getOptionGroupLabel(n),c=a(n,r,o),p=r+"_"+i(n);return e.createElement(e.Fragment,{key:p},e.createElement("li",{className:"p-autocomplete-item-group",style:o},u),c)}var m=t.itemTemplate?s.getJSXElement(t.itemTemplate,n,r):t.field?s.resolveFieldData(n,t.field):n;return e.createElement("li",{key:r,role:"option","aria-selected":t.selectedItem===n,className:"p-autocomplete-item",style:o,onClick:function(e){return t.onItemClick(e,n)}},m,e.createElement(b,null))},c=function(){if(t.virtualScrollerOptions){var n=T(T({},t.virtualScrollerOptions),{style:T(T({},t.virtualScrollerOptions.style),{height:t.scrollHeight}),autoSize:!0,items:t.suggestions,itemTemplate:function(e,t){return e&&u(e,t.index,t)},contentTemplate:function(n){var r=p("p-autocomplete-items",n.className);return e.createElement("ul",{ref:n.contentRef,className:r,role:"listbox",id:t.listId},n.children)}});return e.createElement(h,C({ref:t.virtualScrollerRef},n))}var r=t.suggestions?t.suggestions.map(u):null;return e.createElement("ul",{className:"p-autocomplete-items",role:"listbox",id:t.listId},r)},m=(r=p("p-autocomplete-panel p-component",t.panelClassName),l=T({maxHeight:t.scrollHeight},t.panelStyle||{}),o=c(),e.createElement(v,{nodeRef:n,classNames:"p-connected-overlay",in:t.in,timeout:{enter:120,exit:100},options:t.transitionOptions,unmountOnExit:!0,onEnter:t.onEnter,onEntering:t.onEntering,onEntered:t.onEntered,onExit:t.onExit,onExited:t.onExited},e.createElement("div",{ref:n,className:r,style:l,onClick:t.onClick},o)));return e.createElement(y,{element:m,appendTo:t.appendTo})})));function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}F.displayName="AutoCompletePanel";var A=e.memo(e.forwardRef((function(v,y){var b=j(e.useState(v.id),2),h=b[0],E=b[1],w=j(e.useState(!1),2),I=w[0],D=w[1],N=j(e.useState(!1),2),P=N[0],T=N[1],R=j(e.useState(!1),2),G=R[0],L=R[1],K=e.useRef(null),U=e.useRef(null),H=e.useRef(v.inputRef),_=e.useRef(null),z=e.useRef(null),B=e.useRef(null),J=e.useRef(null),X=j(r({target:K,overlay:U,listener:function(e,t){t.valid&&("outside"===t.type?!Y(e)&&ne():ne())},when:G}),2),q=X[0],V=X[1],Y=function(e){return v.multiple?e.target===_.current||_.current.contains(e.target):e.target===H.current},Z=function(e){B.current&&clearTimeout(B.current);var t=e.target.value;v.multiple||W(e,t),s.isEmpty(t)?(ne(),v.onClear&&v.onClear(e)):t.length>=v.minLength?B.current=setTimeout((function(){$(e,t,"input")}),v.delay):ne()},$=function(e,t,n){null!=t&&("input"===n&&0===t.trim().length||v.completeMethod&&(D(!0),v.completeMethod({originalEvent:e,query:t})))},Q=function(e,t,n){if(v.multiple){if(H.current.value="",!ve(t)){var r=v.value?[].concat(O(l=v.value)||S(l)||x(l)||k(),[t]):[t];W(e,r)}}else te(t),W(e,t);var l;v.onSelect&&v.onSelect({originalEvent:e,value:t}),n||(f.focus(H.current),ne())},W=function(e,t){J&&J.current===t||(v.onChange&&v.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:v.name,id:h,value:t}}),J.current=t)},ee=function(e){if(e){if(v.selectedItemTemplate&&(v.multiple?ve(e):ye(e)>-1)){var t=s.getJSXElement(v.selectedItemTemplate,e);return t||e}if(v.field){var n=s.resolveFieldData(e,v.field);return null!=n?n:e}return e}return""},te=function(e){H.current.value=ee(e)},ne=function(){L(!1),D(!1)},re=function(){f.alignOverlay(U.current,v.multiple?_.current:H.current,v.appendTo||t.appendTo)},le=function(e){v.dropdownAutoFocus&&f.focus(H.current,v.dropdownAutoFocus),"blank"===v.dropdownMode?$(e,"","dropdown"):"current"===v.dropdownMode&&$(e,H.current.value,"dropdown"),v.onDropdownClick&&v.onDropdownClick({originalEvent:e,query:H.current.value})},oe=function(e,t){var n=v.value[t],r=v.value.filter((function(e,n){return t!==n}));W(e,r),v.onUnselect&&v.onUnselect({originalEvent:e,value:n})},ie=function(e){if(G){var t=f.findSingle(U.current,"li.p-highlight");switch(e.which){case 40:if(t){var n=ue(t);n&&(f.addClass(n,"p-highlight"),f.removeClass(t,"p-highlight"),f.scrollInView(be(),n))}else t=f.findSingle(U.current,"li"),f.hasClass(t,"p-autocomplete-item-group")&&(t=ue(t)),t&&f.addClass(t,"p-highlight");e.preventDefault();break;case 38:if(t){var r=ce(t);r&&(f.addClass(r,"p-highlight"),f.removeClass(t,"p-highlight"),f.scrollInView(be(),r))}e.preventDefault();break;case 13:t&&(ae(e,t),ne(),e.preventDefault());break;case 27:ne(),e.preventDefault();break;case 9:t&&ae(e,t),ne()}}if(v.multiple&&8===e.which)if(v.value&&v.value.length&&!H.current.value){var l=v.value[v.value.length-1],o=v.value.slice(0,-1);W(e,o),v.onUnselect&&v.onUnselect({originalEvent:e,value:l})}},ae=function(e,t){v.optionGroupLabel?Q(e,he(v.suggestions[t.dataset.group])[t.dataset.index]):Q(e,v.suggestions[f.index(t)])},ue=function e(t){var n=t.nextElementSibling;return n?f.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},ce=function e(t){var n=t.previousElementSibling;return n?f.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},pe=function(e){T(!0),v.onFocus&&v.onFocus(e)},se=function(e){var t=e.target.value.trim(),n=(v.suggestions||[]).find((function(e){var n=v.field?s.resolveFieldData(e,v.field):e;return n&&t===n.trim()}));n?Q(e,n,!0):(H.current.value="",W(e,null),v.onClear&&v.onClear(e))},me=function(e){T(!1),v.forceSelection&&se(e),v.onBlur&&v.onBlur(e)},fe=function(e){f.focus(H.current),v.onClick&&v.onClick(e)},de=function(e){pe(e),f.addClass(_.current,"p-focus")},ge=function(e){me(e),f.removeClass(_.current,"p-focus")},ve=function(e){return!!v.value&&v.value.some((function(t){return s.equals(t,e)}))},ye=function(e){return v.suggestions?v.suggestions.findIndex((function(t){return s.equals(t,e)})):-1},be=function(){return z.current?U.current.firstChild:U.current},he=function(e){return s.resolveFieldData(e,v.optionGroupChildren)};e.useEffect((function(){s.combinedRefs(H,v.inputRef)}),[H,v.inputRef]),l((function(){h||E(m()),v.autoFocus&&f.focus(H.current,v.autoFocus)})),o((function(){I&&(s.isNotEmpty(v.suggestions)?L(!0):ne(),D(!1))}),[v.suggestions]),o((function(){H.current&&!v.multiple&&te(v.value)})),i((function(){B.current&&clearTimeout(B.current),d.clear(U.current)})),e.useImperativeHandle(y,(function(){return M({search:$,getElement:function(){return K.current},getOverlay:function(){return U.current},getInput:function(){return H.current},getVirtualScroller:function(){return z.current}},v)}));var Ce=function(){var t=ee(v.value),n=G?h+"_list":null,r=p("p-autocomplete-input",v.inputClassName,{"p-autocomplete-dd-input":v.dropdown});return e.createElement(a,{ref:H,id:v.inputId,type:v.type,name:v.name,defaultValue:t,role:"combobox","aria-autocomplete":"list","aria-controls":n,"aria-haspopup":"listbox","aria-expanded":G,"aria-labelledby":v["aria-labelledby"],"aria-label":v["aria-label"],className:r,style:v.inputStyle,autoComplete:"off",readOnly:v.readOnly,disabled:v.disabled,placeholder:v.placeholder,size:v.size,maxLength:v.maxLength,tabIndex:v.tabIndex,onBlur:me,onFocus:pe,onChange:Z,onMouseDown:v.onMouseDown,onKeyUp:v.onKeyUp,onKeyDown:ie,onKeyPress:v.onKeyPress,onContextMenu:v.onContextMenu,onClick:v.onClick,onDoubleClick:v.onDblClick})},Ee=function(){var t=p("p-autocomplete-multiple-container p-component p-inputtext",{"p-disabled":v.disabled}),n=s.isNotEmpty(v.value)?v.value.map((function(t,n){return e.createElement("li",{key:n+"multi-item",className:"p-autocomplete-token p-highlight"},e.createElement("span",{className:"p-autocomplete-token-label"},ee(t)),!v.disabled&&g.getJSXIcon(v.removeIcon,{className:"p-autocomplete-token-icon",onClick:function(e){return oe(e,n)}},{props:v}))})):null;return e.createElement("ul",{ref:_,className:t,onContextMenu:v.onContextMenu,onMouseDown:v.onMouseDown,onClick:fe,onDoubleClick:v.onDblClick},n,e.createElement("li",{className:"p-autocomplete-input-token"},e.createElement("input",{ref:H,type:v.type,disabled:v.disabled,placeholder:v.placeholder,role:"combobox","aria-autocomplete":"list","aria-controls":G?h+"_list":null,"aria-haspopup":"listbox","aria-expanded":G,"aria-labelledby":v["aria-labelledby"],"aria-label":v["aria-label"],autoComplete:"off",tabIndex:v.tabIndex,onChange:Z,id:v.inputId,name:v.name,style:v.inputStyle,className:v.inputClassName,maxLength:v.maxLength,onKeyUp:v.onKeyUp,onKeyDown:ie,onKeyPress:v.onKeyPress,onFocus:de,onBlur:ge})))},we=h+"_list",Oe=s.isNotEmpty(v.tooltip),Se=s.findDiffKeys(v,A.defaultProps),xe=p("p-autocomplete p-component p-inputwrapper",{"p-autocomplete-dd":v.dropdown,"p-autocomplete-multiple":v.multiple,"p-inputwrapper-filled":v.value,"p-inputwrapper-focus":P},v.className),ke=I?e.createElement("i",{className:"p-autocomplete-loader pi pi-spinner pi-spin"}):null,Ie=v.multiple?Ee():Ce(),De=v.dropdown?e.createElement(n,{type:"button",icon:v.dropdownIcon,className:"p-autocomplete-dropdown",disabled:v.disabled,onClick:le}):null;return e.createElement(e.Fragment,null,e.createElement("span",C({ref:K,id:h,style:v.style,className:xe},Se),Ie,ke,De,e.createElement(F,C({ref:U,virtualScrollerRef:z},v,{listId:we,onItemClick:Q,selectedItem:J,onClick:function(e){u.emit("overlay-click",{originalEvent:e,target:K.current})},getOptionGroupLabel:function(e){return v.optionGroupLabel?s.resolveFieldData(e,v.optionGroupLabel):e},getOptionGroupChildren:he,in:G,onEnter:function(){d.set("overlay",U.current,t.autoZIndex,t.zIndex.overlay),re()},onEntering:function(){if(v.autoHighlight&&v.suggestions&&v.suggestions.length){var e=be().firstChild.firstChild;f.addClass(e,"p-highlight")}},onEntered:function(){q(),v.onShow&&v.onShow()},onExit:function(){V()},onExited:function(){d.clear(U.current),v.onHide&&v.onHide()}}))),Oe&&e.createElement(c,C({target:K,content:v.tooltip},v.tooltipOptions)))})));A.displayName="AutoComplete",A.defaultProps={__TYPE:"AutoComplete",id:null,inputRef:null,value:null,name:null,type:"text",suggestions:null,field:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,forceSelection:!1,autoHighlight:!1,virtualScrollerOptions:null,scrollHeight:"200px",dropdown:!1,dropdownMode:"blank",dropdownAutoFocus:!0,multiple:!1,minLength:1,delay:300,style:null,className:null,inputId:null,inputStyle:null,inputClassName:null,panelClassName:null,panelStyle:null,placeholder:null,readOnly:!1,disabled:!1,maxLength:null,size:null,appendTo:null,tabIndex:null,autoFocus:!1,tooltip:null,tooltipOptions:null,completeMethod:null,itemTemplate:null,selectedItemTemplate:null,transitionOptions:null,dropdownIcon:"pi pi-chevron-down",removeIcon:"pi pi-times-circle","aria-label":null,"aria-labelledby":null,onChange:null,onFocus:null,onBlur:null,onSelect:null,onUnselect:null,onDropdownClick:null,onClick:null,onDblClick:null,onMouseDown:null,onKeyUp:null,onKeyPress:null,onContextMenu:null,onClear:null,onShow:null,onHide:null};export{A as AutoComplete};
