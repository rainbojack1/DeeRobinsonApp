import*as e from"react";import t from"primereact/api";import{CSSTransition as n}from"primereact/csstransition";import{useMountEffect as r,useUpdateEffect as o,useOverlayListener as a,useUnmountEffect as l}from"primereact/hooks";import{OverlayService as i}from"primereact/overlayservice";import{Portal as c}from"primereact/portal";import{classNames as u,DomHandler as p,ObjectUtils as s,ZIndexUtils as f}from"primereact/utils";import{Ripple as d}from"primereact/ripple";function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){if(Array.isArray(e))return e}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],l=!0,i=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);l=!0);}catch(e){i=!0,o=e}finally{try{l||null==n.return||n.return()}finally{if(i)throw o}}return a}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function O(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){return b(e)||h(e,t)||g(e,t)||O()}var E=e.memo((function(t){var n=w(e.useState(null),2),a=n[0],l=n[1],i=e.useRef(null),c=function(e){t.onOptionSelect&&t.onOptionSelect(e)},f=function(e,n){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var o=m(r);o&&o.children[0].focus();break;case"Up":case"ArrowUp":var i=v(r);i&&i.children[0].focus();break;case"Right":case"ArrowRight":O(n)&&(a===n?r.children[1].children[0].children[0].focus():l(n));break;case"Left":case"ArrowLeft":l(null);var c=e.currentTarget.parentElement.parentElement.previousElementSibling;c&&c.focus();break;case"Enter":b(e,n);break;case"Tab":case"Escape":t.onPanelHide&&(t.onPanelHide(),e.preventDefault())}e.preventDefault()},m=function e(t){var n=t.nextElementSibling;return n?p.hasClass(n,"p-disabled")||!p.hasClass(n,"p-cascadeselect-item")?e(n):n:null},v=function e(t){var n=t.previousElementSibling;return n?p.hasClass(n,"p-disabled")||!p.hasClass(n,"p-cascadeselect-item")?e(n):n:null},b=function(e,n){O(n)?(l((function(e){return e===n?null:n})),t.onOptionGroupSelect&&t.onOptionGroupSelect({originalEvent:e,value:n})):t.onOptionSelect&&t.onOptionSelect({originalEvent:e,value:g(n)})},h=function(e){t.onOptionGroupSelect&&t.onOptionGroupSelect(e)},y=function(e){return t.optionLabel?s.resolveFieldData(e,t.optionLabel):e},g=function(e){return t.optionValue?s.resolveFieldData(e,t.optionValue):e},O=function(e){return Object.prototype.hasOwnProperty.call(e,t.optionGroupChildren[t.level])},S=function(e){return O(e)?(n=e,t.optionGroupLabel?s.resolveFieldData(n,t.optionGroupLabel):null):y(e);var n};r((function(){if(t.selectionPath&&t.options&&!t.dirty){var e=t.options.find((function(e){return t.selectionPath.includes(e)}));e&&l(e)}var n,r,o,a,c;t.root||(r=p.getOffset(n=i.current.parentElement),o=p.getViewport(),a=i.current.offsetParent?i.current.offsetWidth:p.getHiddenElementOuterWidth(element),c=p.getOuterWidth(n.children[0]),parseInt(r.left,10)+c+a>o.width-p.calculateScrollbarWidth()&&(i.current.style.left="-100%"))})),o((function(){l(null)}),[t.parentActive]);var C=function(n){if(O(n)&&a===n){var r=s.resolveFieldData(n,t.optionGroupChildren[t.level]);return e.createElement(E,{options:r,className:"p-cascadeselect-sublist",selectionPath:t.selectionPath,optionLabel:t.optionLabel,optionValue:t.optionValue,level:t.level+1,onOptionSelect:c,onOptionGroupSelect:h,parentActive:a===n,optionGroupLabel:t.optionGroupLabel,optionGroupChildren:t.optionGroupChildren,dirty:t.dirty,template:t.template,onPanelHide:t.onPanelHide})}return null},P=function(n,r){var o=u("p-cascadeselect-item",{"p-cascadeselect-item-group":O(n),"p-cascadeselect-item-active p-highlight":a===n},n.className),l=C(n),i=t.template?s.getJSXElement(t.template,g(n)):e.createElement("span",{className:"p-cascadeselect-item-text"},S(n)),c=O(n)&&e.createElement("span",{className:"p-cascadeselect-group-icon pi pi-angle-right"}),p=S(n)+"_"+r;return e.createElement("li",{key:p,className:o,style:n.style,role:"none"},e.createElement("div",{className:"p-cascadeselect-item-content",onClick:function(e){return b(e,n)},tabIndex:0,onKeyDown:function(e){return f(e,n)}},i,c,e.createElement(d,null)),l)},G=u("p-cascadeselect-panel p-cascadeselect-items",t.className),j=t.options?t.options.map(P):null;return e.createElement("ul",{ref:i,className:G,role:"listbox","aria-orientation":"horizontal"},j)}));function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=G(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw a}}}}function G(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var L=e.memo(e.forwardRef((function(r,d){var v=w(e.useState(!1),2),b=v[0],h=v[1],y=w(e.useState(!1),2),g=y[0],O=y[1],S=e.useRef(null),G=e.useRef(null),j=e.useRef(null),x=e.useRef(null),D=e.useRef(!1),N=e.useRef(null),I=w(a({target:S,overlay:G,listener:function(e,t){t.valid&&J()},when:g}),2),A=I[0],k=I[1],R=function(e){r.onChange&&r.onChange({originalEvent:e,value:e.value}),K(),J(),p.focus(j.current)},H=function(e){D.current=!0,r.onGroupChange&&r.onGroupChange(e)},T=function(e){return(r.optionLabel?s.resolveFieldData(e,r.optionLabel):e)||e},V=function(e){return r.optionValue?s.resolveFieldData(e,r.optionValue):e},B=function(e,t){return s.resolveFieldData(e,r.optionGroupChildren[t])},F=function(e,t){return Object.prototype.hasOwnProperty.call(e,r.optionGroupChildren[t])},K=function(){var e;if(null!=r.value&&r.options){var t,n=P(r.options);try{for(n.s();!(t=n.n()).done;){if(e=U(t.value,0))break}}catch(e){n.e(e)}finally{n.f()}}N.current=e},U=function e(t,n){if(F(t,n)){var o,a,l=P(B(t,n));try{for(l.s();!(a=l.n()).done;){if(o=e(a.value,n+1))return o.unshift(t),o}}catch(e){l.e(e)}finally{l.f()}}else if(s.equals(r.value,V(t),r.dataKey))return[t];return null},W=function(e){r.disabled||G.current&&G.current.contains(e.target)||(p.focus(j.current),g?J():q())},_=function(){h(!0)},z=function(){h(!1)},M=function(e){switch(e.which){case 40:g?p.findSingle(G.current,".p-cascadeselect-item").children[0].focus():e.altKey&&r.options&&r.options.length&&q(),e.preventDefault();break;case 32:g?J():q(),e.preventDefault();break;case 9:J()}},$=function(e){i.emit("overlay-click",{originalEvent:e,target:S.current})},q=function(){r.onBeforeShow&&r.onBeforeShow(),O(!0)},J=function(){r.onBeforeHide&&r.onBeforeHide(),O(!1),p.focus(j.current)},X=function(){f.set("overlay",G.current,t.autoZIndex,t.zIndex.overlay),ee()},Y=function(){A(),r.onShow&&r.onShow()},Z=function(){k(),D.current=!1},Q=function(){f.clear(G.current),r.onHide&&r.onHide()},ee=function(){p.alignOverlay(G.current,x.current.parentElement,r.appendTo||t.appendTo)};e.useImperativeHandle(d,(function(){return C({getElement:function(){return S.current},getOverlay:function(){return G.current},getInput:function(){return j.current},getLabel:function(){return x.current}},r)})),e.useEffect((function(){s.combinedRefs(j,r.inputRef)}),[j,r.inputRef]),o((function(){K()}),[r.value]),l((function(){f.clear(G.current)}));var te,ne,re,oe,ae,le,ie,ce,ue,pe;return ae=s.findDiffKeys(r,L.defaultProps),le=u("p-cascadeselect p-component p-inputwrapper",{"p-disabled":r.disabled,"p-focus":b,"p-inputwrapper-filled":r.value,"p-inputwrapper-focus":b||g},r.className),te=r.value?T(r.value):void 0,ie=e.createElement("div",{className:"p-hidden-accessible"},e.createElement("input",{ref:j,type:"text",id:r.inputId,name:r.name,defaultValue:te,readOnly:!0,disabled:r.disabled,onFocus:_,onBlur:z,onKeyDown:M,tabIndex:r.tabIndex,"aria-haspopup":"listbox","aria-labelledby":r.ariaLabelledBy})),ne=r.value?T(r.value):r.placeholder||"p-emptylabel",re=u("p-cascadeselect-label ",{"p-placeholder":ne===r.placeholder,"p-cascadeselect-label-empty":!r.value&&"p-emptylabel"===ne}),ce=e.createElement("span",{ref:x,className:re},ne),oe=u("p-cascadeselect-trigger-icon",r.dropdownIcon),ue=e.createElement("div",{className:"p-cascadeselect-trigger",role:"button","aria-haspopup":"listbox","aria-expanded":g},e.createElement("span",{className:oe})),pe=e.createElement(c,{element:e.createElement(n,{nodeRef:G,classNames:"p-connected-overlay",in:g,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:X,onEntered:Y,onExit:Z,onExited:Q},e.createElement("div",{ref:G,className:"p-cascadeselect-panel p-component",onClick:$},e.createElement("div",{className:"p-cascadeselect-items-wrapper"},e.createElement(E,{options:r.options,selectionPath:N.current,className:"p-cascadeselect-items",optionLabel:r.optionLabel,optionValue:r.optionValue,level:0,optionGroupLabel:r.optionGroupLabel,optionGroupChildren:r.optionGroupChildren,onOptionSelect:R,onOptionGroupSelect:H,root:!0,template:r.itemTemplate,onPanelHide:J})))),appendTo:r.appendTo}),e.createElement("div",m({ref:S,id:r.id,className:le,style:r.style},ae,{onClick:W}),ie,ce,ue,pe)})));L.displayName="CascadeSelect",L.defaultProps={__TYPE:"CascadeSelect",id:null,inputRef:null,style:null,className:null,value:null,name:null,options:null,optionLabel:null,optionValue:null,optionGroupLabel:null,optionGroupChildren:null,placeholder:null,itemTemplate:null,disabled:!1,dataKey:null,inputId:null,tabIndex:null,ariaLabelledBy:null,appendTo:null,transitionOptions:null,dropdownIcon:"pi pi-chevron-down",onChange:null,onGroupChange:null,onBeforeShow:null,onBeforeHide:null,onShow:null,onHide:null};export{L as CascadeSelect};
