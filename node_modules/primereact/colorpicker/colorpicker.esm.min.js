import*as e from"react";import n from"primereact/api";import{useOverlayListener as r,useEventListener as t,useMountEffect as o,useUpdateEffect as i,useUnmountEffect as c}from"primereact/hooks";import{OverlayService as a}from"primereact/overlayservice";import{Tooltip as u}from"primereact/tooltip";import{classNames as l,DomHandler as s,ObjectUtils as f,ZIndexUtils as p}from"primereact/utils";import{CSSTransition as d}from"primereact/csstransition";import{Portal as m}from"primereact/portal";function h(){return h=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},h.apply(this,arguments)}function b(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function g(e){if(Array.isArray(e))return e}function v(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],c=!0,a=!1;try{for(r=r.call(e);!(c=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);c=!0);}catch(e){a=!0,o=e}finally{try{c||null==r.return||r.return()}finally{if(a)throw o}}return i}}function y(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function E(e,n){if(e){if("string"==typeof e)return y(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,n):void 0}}function O(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,n){return g(e)||v(e,n)||E(e,n)||O()}var w=e.forwardRef((function(n,r){var t,o=(t=l("p-colorpicker-panel",{"p-colorpicker-overlay-panel":!n.inline,"p-disabled":n.disabled}),e.createElement(d,{nodeRef:r,classNames:"p-connected-overlay",in:n.in,timeout:{enter:120,exit:100},options:n.transitionOptions,unmountOnExit:!0,onEnter:n.onEnter,onEntered:n.onEntered,onExit:n.onExit,onExited:n.onExited},e.createElement("div",{ref:r,className:t,onClick:n.onClick},n.children)));return n.inline?o:e.createElement(m,{element:o,appendTo:n.appendTo})}));function x(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function M(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?x(Object(r),!0).forEach((function(n){b(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}w.displayName="ColorPickerPanel";var T=e.memo(e.forwardRef((function(d,m){var b=k(e.useState(!1),2),g=b[0],v=b[1],y=e.useRef(null),E=e.useRef(null),O=e.useRef(d.inputRef),x=e.useRef(null),C=e.useRef(null),R=e.useRef(null),P=e.useRef(null),j=e.useRef(!1),S=e.useRef(null),N=e.useRef(!1),D=k(r({target:y,overlay:E,listener:function(e,n){n.valid&&ae()},when:g}),2),I=D[0],Y=D[1],A=k(t({type:"mousemove",listener:function(e){N.current&&Q(e),j.current&&L(e)}}),2),H=A[0],K=A[1],B=k(t({type:"mouseup",listener:function(){N.current=j.current=!1,s.removeClass(y.current,"p-colorpicker-dragging"),K(),_()}}),2),X=B[0],_=B[1],z=function(e){d.disabled||(G(),F(e))},F=function(e){d.disabled||(j.current=!0,L(e),s.addClass(y.current,"p-colorpicker-dragging"))},L=function(e){var n=P.current.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);S.current=fe({h:Math.floor(360*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-n)))/150),s:100,b:100}),re(),oe(),V()},U=function(e){d.disabled||(G(),Z(e))},Z=function(e){d.disabled||(N.current=!0,Q(e),s.addClass(y.current,"p-colorpicker-dragging"),e.preventDefault())},$=function(e){N.current&&(Q(e),e.preventDefault()),j.current&&(L(e),e.preventDefault())},q=function(){N.current=!1,j.current=!1,s.removeClass(y.current,"p-colorpicker-dragging"),J()},G=function(){H(),X()},J=function(){K(),_()},Q=function(e){var n=x.current.getBoundingClientRect(),r=n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),t=n.left+document.body.scrollLeft,o=Math.floor(100*Math.max(0,Math.min(150,(e.pageX||e.changedTouches[0].pageX)-t))/150),i=Math.floor(100*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-r)))/150);S.current=fe({h:S.current.h,s:o,b:i}),te(),ie(),V()},V=function(){switch(d.format){case"hex":ne(ge(S.current));break;case"rgb":ne(he(S.current));break;case"hsb":ne(S.current)}},W=function(e){var n;if(e)switch(d.format){case"hex":n=de(e);break;case"rgb":n=me(e);break;case"hsb":n=e}else n=de(d.defaultColor);return n},ee=function(e){S.current=W(e)},ne=function(e){d.onChange&&d.onChange({value:e,stopPropagation:function(){},preventDefault:function(){},target:{name:d.name,id:d.id,value:e}})},re=function(){if(x.current){var e=fe({h:S.current.h,s:100,b:100});x.current.style.backgroundColor="#"+ge(e)}},te=function(){C.current&&(C.current.style.left=Math.floor(150*S.current.s/100)+"px",C.current.style.top=Math.floor(150*(100-S.current.b)/100)+"px")},oe=function(){R.current&&(R.current.style.top=Math.floor(150-150*S.current.h/360)+"px")},ie=function(){O.current&&(O.current.style.backgroundColor="#"+ge(S.current))},ce=function(){v(!0)},ae=function(){v(!1)},ue=function(){le()},le=function(){g?ae():ce()},se=function(e){switch(e.which){case 32:le(),e.preventDefault();break;case 27:case 9:ae()}},fe=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},pe=function(e){var n=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:n>>16,g:(65280&n)>>8,b:255&n}},de=function(e){return me(pe(e))},me=function(e){var n={h:0,s:0,b:0},r=Math.min(e.r,e.g,e.b),t=Math.max(e.r,e.g,e.b),o=t-r;return n.b=t,n.s=0!==t?255*o/t:0,n.h=0!==n.s?e.r===t?(e.g-e.b)/o:e.g===t?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,n.h*=60,n.h<0&&(n.h+=360),n.s*=100/255,n.b*=100/255,n},he=function(e){var n={r:null,g:null,b:null},r=Math.round(e.h),t=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0===t)n={r:o,g:o,b:o};else{var i=o,c=(255-t)*o/255,a=r%60*(i-c)/60;360===r&&(r=0),r<60?(n.r=i,n.b=c,n.g=c+a):r<120?(n.g=i,n.b=c,n.r=i-a):r<180?(n.g=i,n.r=c,n.b=c+a):r<240?(n.b=i,n.r=c,n.g=i-a):r<300?(n.b=i,n.g=c,n.r=c+a):r<360?(n.r=i,n.g=c,n.b=i-a):(n.r=0,n.g=0,n.b=0)}return{r:Math.round(n.r),g:Math.round(n.g),b:Math.round(n.b)}},be=function(e){var n=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];for(var r in n)1===n[r].length&&(n[r]="0"+n[r]);return n.join("")},ge=function(e){return be(he(e))},ve=function(){oe(),te(),ie(),re()},ye=function(){O.current&&s.alignOverlay(E.current,O.current.parentElement,d.appendTo||n.appendTo)};e.useImperativeHandle(m,(function(){return M({show:ce,hide:ae,getElement:function(){return y.current},getOverlay:function(){return E.current},getInput:function(){return O.current}},d)})),e.useEffect((function(){f.combinedRefs(O,d.inputRef)}),[O,d.inputRef]),o((function(){ee(d.value),ve()})),i((function(){N.current||j.current||ee(d.value)}),[d.value]),i((function(){ve()})),c((function(){p.clear(E.current)}));var Ee=f.isNotEmpty(d.tooltip),Oe=f.findDiffKeys(d,T.defaultProps),ke=l("p-colorpicker p-component",{"p-colorpicker-overlay":!d.inline},d.className),we=e.createElement("div",{className:"p-colorpicker-content"},e.createElement("div",{ref:x,className:"p-colorpicker-color-selector",onMouseDown:U,onTouchStart:Z,onTouchMove:$,onTouchEnd:q},e.createElement("div",{className:"p-colorpicker-color"},e.createElement("div",{ref:C,className:"p-colorpicker-color-handle"}))),e.createElement("div",{ref:P,className:"p-colorpicker-hue",onMouseDown:z,onTouchStart:F,onTouchMove:$,onTouchEnd:q},e.createElement("div",{ref:R,className:"p-colorpicker-hue-handle"}))),xe=function(){if(!d.inline){var n=l("p-colorpicker-preview p-inputtext",{"p-disabled":d.disabled}),r=f.findDiffKeys(d,T.defaultProps);return e.createElement("input",h({ref:O,type:"text",className:n,readOnly:!0,id:d.inputId,tabIndex:d.tabIndex,disabled:d.disabled,onClick:ue,onKeyDown:se},r))}return null}();return e.createElement(e.Fragment,null,e.createElement("div",h({ref:y,id:d.id,style:d.style,className:ke},Oe),xe,e.createElement(w,{ref:E,appendTo:d.appendTo,inline:d.inline,disabled:d.disabled,onClick:function(e){d.inline||a.emit("overlay-click",{originalEvent:e,target:y.current})},in:d.inline||g,onEnter:function(){p.set("overlay",E.current,n.autoZIndex,n.zIndex.overlay),ye()},onEntered:function(){I(),d.onShow&&d.onShow()},onExit:function(){Y()},onExited:function(){p.clear(E.current),d.onHide&&d.onHide()},transitionOptions:d.transitionOptions},we)),Ee&&e.createElement(u,h({target:y,content:d.tooltip},d.tooltipOptions)))})));T.displayName="ColorPicker",T.defaultProps={__TYPE:"ColorPicker",id:null,inputRef:null,value:null,style:null,className:null,defaultColor:"ff0000",inline:!1,format:"hex",appendTo:null,disabled:!1,tabIndex:null,inputId:null,tooltip:null,tooltipOptions:null,transitionOptions:null,onChange:null,onShow:null,onHide:null};export{T as ColorPicker};
